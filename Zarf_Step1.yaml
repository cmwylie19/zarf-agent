# === Secret created before webhook pod scenario. ===

# In the event that the secret exists before the webhook pod,
# we have no way of eventing off of the creation event in the webhook.
# In this scenario we bind the secret to the pod and read them from
# the filesystem.


apiVersion: v1
kind: Pod
metadata:
  creationTimestamp: null
  labels:
    run: zarf-agent
  name: zarf-agent
spec:
  volumes:
  - name: zarf-state
    secret:
      secretName: zarf-state
  - name: private-registry
    secret:
      secretName: private-registry
  containers:
  - image: cmwylie19/nginx-jq 
    name: zarf-agent
    resources: {}
    command: ["sh", "-c", "while true; do cat  /var/lib/zarf/state/state /var/lib/zarf/registry/.dockerconfigjson | jq; sleep 10;done"]
    volumeMounts:
    - name: zarf-state
      mountPath: /var/lib/zarf/state
    - name: private-registry
      mountPath: /var/lib/zarf/registry
  dnsPolicy: ClusterFirst
  restartPolicy: Always
status: {}
---
apiVersion: v1
data:
  state: eyJ6YXJmQXBwbGlhbmNlIjpmYWxzZSwiZGlzdHJvIjoia2luZCIsImFyY2hpdGVjdHVyZSI6ImFybTY0Iiwic3RvcmFnZUNsYXNzIjoic3RhbmRhcmQiLCJhZ2VudFRMUyI6eyJjYSI6IkxTMHRMUzFDUlVkSlRpQkRSVkpVU1VaSlEwRlVSUzB0TFMwdENrMUpTVVJYVkVORFFXdEhaMEYzU1VKQlowbFJVVTloZUVGcVNsQnJhVElyTTJGT1JERkJVbXR1YWtGT1FtZHJjV2hyYVVjNWR6QkNRVkZ6UmtGRVFUTUtUVkpqZDBaUldVUldVVkZMUlhjMVlWbFlTbTFKUlU1MllsY3hNV0p0YkRCbFZFVmpUVUp2UjBFeFZVVkJlRTFVV1RKRmRXTklTbkJrYlVZd1dsTTFOZ3BaV0VwdFRHMVNiR1JxUVdWR2R6QjVUWHBCTWsxVVZYaE5hbFV4VFVSQ1lVWjNNSGxPUkVFeVRXcFJlRTFxVlRGTlJFSmhUVVJqZUVaNlFWWkNaMDVXQ2tKQmIxUkViSEJvWTIxWloxRXlPWFJpV0ZaMVlWaFNOVTFTZDNkSFoxbEVWbEZSUkVWNFRtcFpVelYzWTIxc01sbFlVbXhNYm5Cb1kyMVpkVnBIVmpJS1RVbEpRa2xxUVU1Q1oydHhhR3RwUnpsM01FSkJVVVZHUVVGUFEwRlJPRUZOU1VsQ1EyZExRMEZSUlVGM1QybFRXV3B2U21aTFRtaFlTbVlyYjI1bGFBcHhXRWcyYW5rd1NFUnpiVmdyTTFOYU9GbGtVa2xqTDNaWUwzbE1WRlVyTjBaU2VESm5jV1pJYkhwUGIwUkRZbnBsVDBwelEwZzNUMk0xZVdScmRFUnNDbkJLUjNOME5uVjNNbFJOUkZGUlQySmFaR1ZGVFRsQ1NHOXNWalpRWkhRMVVIRjBRVGRVTDNOWGR6Z3ZXamxyU0VoR1NrNUlSM1V5WmtkWVExVTJjVTBLTTBaeksyOVhkMGcyUmxaSFdrWldOMUZvZW1KVFJIQktjazlvYUZCTlExVjBSMDQxV25kdmIybDJSRUp6UzJacWMyWmxjMlE0UzB0NlIwcEdPVE54YkFwWGJGcDZkWEZhTHpGbVZHWlJSVFl3ZVRrMVpHZFFhRWQyVkRkeE1IVjNUUzlzVFhnM2RGSjNibTVEY0V0QlYxQjNaV3hMVFRsUFJrUTNhMUJvVjBwS0NqTkdkRW94V21OUFdHVkRlR053Y2xkVGVUbEJiMmxYVTFCemNHaFBUbVJhV0ZSc1dVWTBaWFJNZEVKdldXWTJNM2RCVkVJck5ubGlOVmszTTBad2JUWUtOWGRKUkVGUlFVSnZNa1YzV0hwQlQwSm5UbFpJVVRoQ1FXWTRSVUpCVFVOQmIxRjNTRkZaUkZaU01HeENRbGwzUmtGWlNVdDNXVUpDVVZWSVFYZEZSd3BEUTNOSFFWRlZSa0ozVFVOTlFUaEhRVEZWWkVWM1JVSXZkMUZHVFVGTlFrRm1PSGRJVVZsRVZsSXdUMEpDV1VWR1JXOXRlRkFyYTJJdmJtaHBkVmh2Q2tWTlJrUkZhbEIxWVRVeGVVMUJNRWREVTNGSFUwbGlNMFJSUlVKRGQxVkJRVFJKUWtGUlFXZGtRMWhqU1dSMVFuRnlPVnBLVEZoU2IwOHpWM1pWYmxRS1RrMXBiRXBuY2xGbVlUWXJVVTg1WW1SRWVtWlVXbTVXVldwSE1VSjFOR28zZGpWUE0zSTFWbmQ2ZFN0cGJFaENhVlF3VkVSNU9FeHdiREpKYUVzM2VRcHdOV0l6Y0VaQ1QwMVZkbFZ6VWtwdWVrdFpTSG94VjJaRWVHeDZZbEk1VDJWTE5qbFNhM1l5Ym1oRWVEZE9LM1I0V2xsSGNsTXdZa1pyY0ZOTFpIbExDa041TVVsUU4wSjFjeXRTYVd0TmFqTkplV1p2ZHpGd2NrNUZjMnMxUjB3NVNWaDJaR2RaTUd4ek0wcFNVbXBRUVhsRFNVZFhiVEZFTlRjME1tZHFkbklLTTFWTlpXVnRiSGhXVWxsbVpEaGhUVkpMVlhrMWRqRjRRWGhDWld3NFJHYzNSbTlzZFRaa1YzaERNVEJsY1cweWNIVTVkM0EwT0ZnclJ6Sm9PWEJYU0FvMFpuWlVOWG9yYmt3MFJIQmtRa1Y2WlN0cFNVSklhbTkwYzFsUk5HRmxMMFVyTTFrcmFUYzJNRTR6YmpGT1ozRXhkSEowWkU1RWNXdFhaSE1LTFMwdExTMUZUa1FnUTBWU1ZFbEdTVU5CVkVVdExTMHRMUW89IiwiY2VydCI6IkxTMHRMUzFDUlVkSlRpQkRSVkpVU1VaSlEwRlVSUzB0TFMwdENrMUpTVVJqZWtORFFXeDFaMEYzU1VKQlowbFNRVTVDVVV0Wk9HOTZVazVzVlhkRVUwVlFaWGRwVnpoM1JGRlpTa3R2V2tsb2RtTk9RVkZGVEVKUlFYY0tUbnBGV0UxQ1ZVZEJNVlZGUTJoTlQxZHRSbmxhYVVKRVlqSXhkR1JYTlhCa1NHdDRTRVJCWVVKblRsWkNRVTFVUlRKT2FFeHVRbmxoV0Zwb1pFZFZkUXBsYlVaNVdtazFhMXBZV1hkSWFHTk9UV3BOZDA1cVJURk5WRWt4VGxSQmQxZG9ZMDVOYWxGM1RtcEpNRTFVU1RGT1ZFRjNWMnBCTVUxU1ZYZEZkMWxFQ2xaUlVVdEZkM2hoV1ZoS2JVbEZUbk5rV0U0d1dsaEplRWhFUVdGQ1owNVdRa0ZOVkVVeVJtNWFWelV3VEZkb2RtSXljM1ZsYlVaNVdtazFlbVJ0VFhjS1oyZEZhVTFCTUVkRFUzRkhVMGxpTTBSUlJVSkJVVlZCUVRSSlFrUjNRWGRuWjBWTFFXOUpRa0ZSUkZGUGJVTk5jM0JsT1RVM1NUSkdWRVVyZFU4eVlncDNWRUp0V0Vsd1YyaEtkazQxYTBoT1pUZERNVEkyVUROa1NVbFhOMVpQZVZaTk4xTkZialJxUWt4MFptZFBPVUpwT1hkT05ERlpUQzkzY2l0emREQlBDblpRWnpKVlYyZEJNR05OT0hscVZVWlNNV0ZzVkdORFpYRjNNRVpVV1hsMlIyWTRXSEJUVFRkU1owTXpUMjh3ZFZoS2VIUnlRVVIzY0hkdllVMTJieThLVW5aVlVTODRlRU5JWW5Wd2NWaHlaalZUUlN0MWIyWm5aekIzYkRoQ1JHRmtXV3RMV0ZnMGFGbHZiVUk1YmtSTlRsSTBOM2hTYXpZMFV6VjZWRmRTVkFveVF6ZFdMelJMWVZoUVIzSm1TMlZhVEVwRmNDc3hVbEEwVEN0Q1ozbFpPRE52T1VoNE0zb3pRVlZ1YVhBelRsYzRVRFE1ZUZSUVZXdFdkRGQwZEhaNUNpOUJNVkpMWVRjemFXb3ZNRVIzUTJRMU1VTk9URWhvWW5ob1ZGcDFhUzl4TlZBeWJsWnNXVkkzYjFvMlducGhNR05yWmxkdVVGaFdka0ozU2twaVJYUUtRV2ROUWtGQlIycG1SRUkyVFVFMFIwRXhWV1JFZDBWQ0wzZFJSVUYzU1VadlJFRlVRbWRPVmtoVFZVVkVSRUZMUW1kbmNrSm5SVVpDVVdORVFWUkJUUXBDWjA1V1NGSk5Ra0ZtT0VWQmFrRkJUVUk0UjBFeFZXUkpkMUZaVFVKaFFVWkZiMjE0VUN0cllpOXVhR2wxV0c5RlRVWkVSV3BRZFdFMU1YbE5RMUZIQ2tFeFZXUkZVVkZrVFVKMVEwVXlSbTVhVnpVd1RGZG9kbUl5YzNWbGJVWjVXbWsxZW1SdFQwaENTRGhCUVVGRmQwUlJXVXBMYjFwSmFIWmpUa0ZSUlV3S1FsRkJSR2RuUlVKQlNXSk9lVXcyTlhOTE5Ia3pkMWQyYm01NWNVVmFabnBzVjNCVE9IaG5TWFV6V1ZoMmJqTTBOa0oyVkZWRE9YSlRUMmw0YnpGc1lncHdSVkJsVG5wVGJtWlFXbU12Y0RjNFZsZElWRzFFTTFWNFdYSlVMMFZ5UkdkeE0zVTJkbTQzT0V4QmJtWnJkM3BMSzJwNlpuRjJkVXBFTmtVeVZHNVJDbVZDTDBJNVRVaHZURlZ2YVVsV1YzSnVSRmR4TWt0YVVHOWliM2g2TW1sM1QyMWFOamw1U0hSWmJuTldLekZOSzNCNWJuSlFZMUUzZGpoWlVFcE9VMmdLYjBsRFZYUnpZa0ZRT0ZwS2VtSlNSVzFaTldSeFVWaHdiek55U2pSRGFGbDBaRGhoYjFSb1R6SjFSM2RJVjBkYVFWWXJlRGc1U0ZsVmRFdGxZek16T0FvMVVsSnpjVzlyUTFCclMwbEZiVFJYYUdSTE5WVjRMek5tUzBKcU5EUTNOR3haUm1OMlRFaHBWV2RpVlRjcmMwSTRiV0YzZEZRM1pFaDZjekZUT0RGc0NtVm9SWEpTV1dOWFVYbG5VVEI1ZVRGM2Vta3lTbmxOWVd3MlZFZG1ZMk05Q2kwdExTMHRSVTVFSUVORlVsUkpSa2xEUVZSRkxTMHRMUzBLIiwia2V5IjoiTFMwdExTMUNSVWRKVGlCU1UwRWdVRkpKVmtGVVJTQkxSVmt0TFMwdExRcE5TVWxGY0VGSlFrRkJTME5CVVVWQk1FUndaMnBNUzFoMlpXVjVUbWhWZUZCeWFuUnRPRVYzV214NVMxWnZVMko2WlZwQ2VsaDFkM1JrZFdvNU0xTkRDa1oxTVZSemJGUlBNR2hLSzBsM1V6ZFlORVIyVVZsMlkwUmxUbGRETHpoTEwzSk1aRVJ5ZWpST2JFWnZRVTVJUkZCTmJ6RkNWV1JYY0ZVelFXNXhjMDRLUWxVeVRYSjRiaTlHTmxWcVR6QlpRWFI2Y1U1TWJIbGpZbUYzUVRoTFkwdEhha3cyVURCaU1VVlFMMDFSYURJM2NXRnNOak1yVldoUWNuRklORWxPVFFwS1prRlJNbTVYU2tOc01TdEpWMHRLWjJaYWQzcEVWV1ZQT0ZWYVQzVkZkV013TVd0Vk9XZDFNV1lyUTIxc2VuaHhNM2x1YlZONVVrdG1kRlZVSzBNdkNtZFpUVzFRVGpaUVVqaGtPRGwzUmtvMGNXUjZWblpFSzFCalZYb3hTa1ppWlRkaVlqaDJkMDVWVTIxMU9UUnZMemxCT0VGdVpXUlJhbE40TkZjNFdWVUtNbUp2ZGpaMVZEbHdNVnBYUldVMlIyVnRZekowU0VwSU1YQjZNVEZpZDJORFUxZDRURkZKUkVGUlFVSkJiMGxDUVVWcVJFeFlkbU0yU1U0eU1VZEtjZ3B6TWt0amEyOU5jakZtVEdaQldWSk5TVWh0Y0hKWVRGWmtlVWRHVmpreVpuVTViWGhKZERoa1NGbDRkelE1ZW5WNVZqaE9SMmMwU1dodFVHWXZaa05DQ2s1bFJtTjBWSGg1VFdwWlp6WnFkbTVGVG1STlVGbDZWSEZsV201eWFHbEVOSGt2YjAxdVNEVnVjR04yYjBsclZUVkRhMmszTjFNd2NtZEVkeloyT0hRS1JEWXljVUpMU2xvNVJXSXhZUzlZY1d3cmIyOXFRVko1T1RsUlNVUnZNbmhNTTNOcFlVbHljVkpYY0ZGR05UbEdjMUJxYVhkd1MweDNOWFkwTUhkck53cFFUSGRSVUVNeWRVZEJiR3BpTjJ4RlJYTllZVGRTTjJKelQySmxVRTgxVkhoUldXOU9kRVJEUkVKUFdqQkJkSEZ4VmtKUWIxSXpaVEZTWkdnMU0zRTNDbHBpY1VaQ1YzUnVRbVJrVEhCM2VEYzNVR2czUzFBcmFqWnZWMDR4UmtOWVkyTXhTblZYTldKa2JWQlhlbFpwVDJoMVYzVTNNblpXTkhjcmRuVm1VbmtLVW05d2FrcEZSVU5uV1VWQkszRldWak5tVGtZelUxWXZha2RQVTNaVlpUTmtXbVo0ZURWNFNqbEJiVmcyS3pKVVNIUnVkMm8yV0RkR2VFdGxWbTVRY0FwMGIzRlNSamRITlZsVmMxcDZialZTTjNKQlowWXlkMGhIZW5vd1JrWkpTVkI2Y2xGcWMwTlNjSGsyZVhkTlZrVkRWV2RZYWxJME1uZG1OMkl6VjA5R0NrNUxaazlUUjJOamREZHNSbmRVZG5WWFMwTm5jVGR1TDFKWk4wWkpUV1pTV0hVclowWlVaRnBVYzNGalR6QkNSMFJEY0ZWTE56QkRaMWxGUVRGTE1GVUtTV0ZsWjJ4TVRWWjNTemR3ZHpKeVVtVlRPWHBuU2xaUmR6bE9iVmhqYUdkemFYQlhZa1J3VERsM1JYaEZaVlZzZEZKRGJIaHNUR1EwTlVsa2VFTlVWUXBwZVdSek9EUklSVWhqU2swNVVWZHZlbWhTVWtaTVUxcHFRbHB1ZG10MWJFeGxja0ZwZEROTlUyYzBSa1pzUWtoTFVVZERPVlpTVkdWbU16SlZia2xYQ2tKSmNFTTBWa2RRT0VKQ1NVbGpVMHM1VFNzNVptMVdjUzlpVDNneFlYSnFWRWxrY1hWcVJVTm5XVVZCTTBkUWJ6TjFTamhQWm05M04zbGlWemR0ZUZRS1IzRnNhVkphZUdSUmNVZ3dNMlJVYlcxcFoxVmhTbk5RTnpkbVJsWnJkRkkwT1hCMmRtZ3ZaREl6YTBneGFGRnZkM1pLU0VwYVJYUndiblYzVDNaWWRRcHVibkFyZWtOaWVtRTRaV0ZGWm5KcE1tazFlakYyWjAxUFoxSTFSekl2V1haMldWZFpiaXRaVG5ONFNWVTJURFEzZVVVcldtZEhSVkJ2ZEU1T2IyVTRDbmd2WkRSRlZ5czNjbHBhYlZSWmN6QnFTbTVxY2xKclEyZFpSVUY2VmtoRGVUZE1ka2hzS3l0TmJWVnlTRkpRTURSM0wybGlSa3MyZUVST1JUaHRiRThLYjFCTGNYVktWMWhZVVVaNmFFSnJOMVJDUTJ0WGJFVkxSVzVsZGpoUWNURnFlRzlwTTNaME5tZEdhR2wyTTBsV1VUZzNkR05DV0dremVFZExWMjVpYUFwSmRrVjBjbGRNZG5CT1ltZEtiV2xsUzI5S2FFVmpUekZUTWt4WksxVk9WelpyT0c5MmFYQnNNRnBsUjJFNFRUVmxOWFJNUkRodFRtWjRlVXRLVVU1NkNuRlRRbUU0ZVVWRFoxbENSRlF2WTFOdlpGaFRlV3d4WTBwT1MwMDBTalJzU1hSb1UyMTRNRmhHUlM5b1lrSkJObkZyZGxkUlpHMVFNMmhUYkdzeVRERUtNMlZHUTFRMk9UZEtlRVo0WkZoMGJYSTJOVmcwZVdacGNscEdUMDFOVUVGU2IxWjNRbE5yV25wRGJXbFpUa294VEROcWRrNHlNWFZpVGsxRE4yTnNRd3AyWldad1pFczFVa3hPVlM5cmNHTTRiR2h6ZUhGUlkwaHlaRTFEYzBsWkszVk5ZbXh1YkdOa1dIZHphVTVWWkVkd01UUkJNSGM5UFFvdExTMHRMVVZPUkNCU1UwRWdVRkpKVmtGVVJTQkxSVmt0TFMwdExRbz0ifSwiZ2l0U2VydmVyIjp7InB1c2hVc2VybmFtZSI6InphcmYtZ2l0LXVzZXIiLCJwdXNoUGFzc3dvcmQiOiJCcW5LIWZRSUl6V2NrdzZGM25zbEpqQ2wiLCJwdWxsVXNlcm5hbWUiOiJ6YXJmLWdpdC1yZWFkLXVzZXIiLCJwdWxsUGFzc3dvcmQiOiJsR0JGWlh5NGN1Rkp4VmtSNzJUUlppVEoiLCJhZGRyZXNzIjoiaHR0cDovL3phcmYtZ2l0ZWEtaHR0cC56YXJmLnN2Yy5jbHVzdGVyLmxvY2FsOjMwMDAiLCJpbnRlcm5hbFNlcnZlciI6dHJ1ZX0sInJlZ2lzdHJ5SW5mbyI6eyJwdXNoVXNlcm5hbWUiOiJ6YXJmLXB1c2giLCJwdXNoUGFzc3dvcmQiOiI0QURWSU0zUTc5YkJZUm9+NzdzM3AxUS0iLCJwdWxsVXNlcm5hbWUiOiJ6YXJmLXB1bGwiLCJwdWxsUGFzc3dvcmQiOiJmdTd0aGdyLUQyOHg0ZGRIN0RyaDUyTlIiLCJhZGRyZXNzIjoiMTI3LjAuMC4xOjMxOTk5Iiwibm9kZVBvcnQiOjMxOTk5LCJpbnRlcm5hbFJlZ2lzdHJ5Ijp0cnVlLCJzZWNyZXQiOiI3cEh3aFk3T3IxVExXVVBDYWxFSEdZVklRdnV4b1c3Qm5YMDh4amhLaUFMT3JYQkgifSwiYXJ0aWZhY3RTZXJ2ZXIiOnsicHVzaFVzZXJuYW1lIjoiemFyZi1naXQtdXNlciIsInB1c2hQYXNzd29yZCI6IiIsImFkZHJlc3MiOiJodHRwOi8vemFyZi1naXRlYS1odHRwLnphcmYuc3ZjLmNsdXN0ZXIubG9jYWw6MzAwMC9hcGkvcGFja2FnZXMvemFyZi1naXQtdXNlciIsImludGVybmFsU2VydmVyIjp0cnVlfSwibG9nZ2luZ1NlY3JldCI6In5GamhsSGhySFJiN29rR3hEWWhMZHBuNyJ9
kind: Secret
metadata:
  labels:
    app.kubernetes.io/managed-by: zarf
  name: zarf-state
type: Opaque
---
apiVersion: v1
data:
  .dockerconfigjson: eyJhdXRocyI6eyIxMjcuMC4wLjE6MzE5OTkiOnsiYXV0aCI6ImVtRnlaaTF3ZFd4c09tWjFOM1JvWjNJdFJESTRlRFJrWkVnM1JISm9OVEpPVWc9PSJ9fX0=
kind: Secret
metadata:
  labels:
    app: zarf-injector
    app.kubernetes.io/managed-by: zarf
    zarf.dev/agent: ignore
  name: private-registry
type: kubernetes.io/dockerconfigjson

